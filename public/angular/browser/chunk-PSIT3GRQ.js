import{a as h}from"./chunk-G25BJCFI.js";import"./chunk-GR6YHOP3.js";import{a as O,b as A}from"./chunk-EEZQA65K.js";import{B as s,D as n,E as g,Ga as M,I as S,Ia as I,K as l,M as d,Na as j,P as a,Q as p,R as u,S as w,T as c,U as f,V as x,W as C,X as y,Z as m,p as b,q as _,wa as T,x as P,ya as N}from"./chunk-6P4DJA2C.js";function B(o,i){if(o&1){let e=w();a(0,"app-textarea",7,0),c("sendText",function(r){b(e);let v=f();return _(v.add(r))}),p()}if(o&2){let e=f();l("placeholderText","What is happening?")("disablePostButton",e.disablePostButton)}}function D(o,i){o&1&&(a(0,"p",3),m(1,"Login to post"),p())}function E(o,i){o&1&&u(0,"br")(1,"progress",8)}var R=class o{constructor(i,e,t,r,v,V){this._postService=i;this._authService=e;this.viewportScroller=t;this.route=r;this.router=v;this.platformId=V}allPosts=[];pageNumber=0;disablePostButton=!1;loading=!1;showProgress=!1;textarea;request;ngOnInit(){this.pageNumber=Number(this.route.snapshot.paramMap.get("page")),this.getAllPosts(this.pageNumber)}getAllPosts(i){T(this.platformId)&&(this.loading=!0),this._postService.getAllPosts(this._authService.userdata()?.id??null,i??0).subscribe({next:e=>{this.allPosts=e,this.viewportScroller.scrollToPosition([0,0]),this.loading=!1}})}add(i){this.disablePostButton=!0,this.showProgress=!0,this._postService.addNewPost({content:i.content,parentpostid:null,file:i.file}).pipe().subscribe({next:e=>{this.pageNumber=0,this.getAllPosts(0),this.disablePostButton=!1,this._postService.postSuccessSubject.next("success"),this.showProgress=!1,this.textarea.reset()},error:e=>{alert(e.error),this.disablePostButton=!1,this._postService.postSuccessSubject.next("fail"),this.showProgress=!1}})}loadNew(){this.pageNumber--,this.router.navigate(["main",this.pageNumber])}loadOld(){this.pageNumber++,this.router.navigate(["main",this.pageNumber])}ngOnDestroy(){}static \u0275fac=function(e){return new(e||o)(n(O),n(j),n(N),n(M),n(I),n(P))};static \u0275cmp=g({type:o,selectors:[["app-main"]],viewQuery:function(e,t){if(e&1&&x(h,5),e&2){let r;C(r=y())&&(t.textarea=r.first)}},decls:10,vars:6,consts:[["textarea",""],[1,"container"],[3,"placeholderText","disablePostButton"],[1,"text-area-p"],[3,"list","showSeperator"],[2,"display","flex","justify-content","space-between"],[3,"click","disabled"],[3,"sendText","placeholderText","disablePostButton"],["aria-busy","true"]],template:function(e,t){e&1&&(a(0,"div",1),S(1,B,2,2,"app-textarea",2)(2,D,2,0,"p",3)(3,E,2,0),u(4,"app-postlist",4),a(5,"div",5)(6,"button",6),c("click",function(){return t.loadNew()}),m(7,"Load New"),p(),a(8,"button",6),c("click",function(){return t.loadOld()}),m(9,"Load Older"),p()()()),e&2&&(s(),d(t._authService.userdata()?1:2),s(2),d(t.showProgress?3:-1),s(),l("list",t.allPosts)("showSeperator",!1),s(2),l("disabled",t.pageNumber==0),s(2),l("disabled",t.allPosts[t.allPosts.length-1]&&t.allPosts[t.allPosts.length-1].id==1))},dependencies:[A,h],styles:["button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:auto}"]})};export{R as MainComponent};
