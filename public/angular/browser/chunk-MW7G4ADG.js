import{a as v}from"./chunk-4UGJJLBB.js";import"./chunk-ECERN3PL.js";import{a as K,b as E}from"./chunk-MHBETSCG.js";import{B as n,D as r,E as I,Ea as j,Fa as D,I as y,Ia as O,K as l,Ka as R,M as u,P as a,Pa as B,Q as p,R as h,S as A,T as c,U as f,V as x,W as C,X as M,Z as d,n as _,p as S,q as P,wa as m,x as T,xa as g,y as w,ya as N}from"./chunk-G6XVCMRK.js";function k(o,t){if(o&1){let e=A();a(0,"app-textarea",7,0),c("sendText",function(s){S(e);let b=f();return P(b.add(s))}),p()}if(o&2){let e=f();l("placeholderText","What is happening?")("disablePostButton",e.disablePostButton)}}function Q(o,t){o&1&&(a(0,"p",3),d(1,"Login to post"),p())}function L(o,t){o&1&&h(0,"br")(1,"progress",8)}var V=class o{constructor(t,e,i,s,b,q,F,U){this._postService=t;this._authService=e;this.viewportScroller=i;this.route=s;this.router=b;this.platformId=q;this.titleService=F;this.metaService=U}allPosts=[];pageNumber=0;disablePostButton=!1;loading=!1;showProgress=!1;textarea;request;MAIN_DATA="MAIN_DATA";transferState=_(w);ngOnInit(){this.titleService.setTitle("Khichdi"),g(this.platformId)&&(this.pageNumber=Number(this.route.snapshot.paramMap.get("page")),this.getAllPosts(this.pageNumber),this.metaService.addTags([{name:"description",content:"Khichdi is a fast, simple, and Indian-focused microblogging platform to share thoughts, updates, and trends."},{name:"author",content:"Khichdi Team"},{property:"og:title",content:"Khichdi Team"},{property:"og:description",content:"Khichdi is a fast, simple, and Indian-focused microblogging platform to share thoughts, updates, and trends."},{property:"og:type",content:"website"},{name:"twitter:title",content:"Khichdi"},{name:"twitter:description",content:"Khichdi is a fast, simple, and Indian-focused microblogging platform to share thoughts, updates, and trends."}])),m(this.platformId)&&this.route.paramMap.subscribe(t=>{this.pageNumber=Number(t.get("page")),this.getAllPosts(Number(t.get("page")))})}getAllPosts(t){if(m(this.platformId)){let e=this.transferState.get(this.MAIN_DATA,null);if(e){this.allPosts=e,this.transferState.remove(this.MAIN_DATA);return}}this._postService.getAllPosts(this._authService.userdata()?.id??null,t??0).subscribe({next:e=>{g(this.platformId)&&this.transferState.set(this.MAIN_DATA,e),this.allPosts=e,m(this.platformId)&&this.viewportScroller.scrollToPosition([0,0])}})}add(t){this.disablePostButton=!0,this.showProgress=!0,this._postService.addNewPost({content:t.content,parentpostid:null,file:t.file}).pipe().subscribe({next:e=>{this.pageNumber=0,this.getAllPosts(0),this.disablePostButton=!1,this._postService.postSuccessSubject.next("success"),this.showProgress=!1,this.textarea.reset()},error:e=>{alert(e.error),this.disablePostButton=!1,this._postService.postSuccessSubject.next("fail"),this.showProgress=!1}})}loadNew(){this.pageNumber--,this.router.navigate(["main",this.pageNumber])}loadOld(){this.pageNumber++,this.router.navigate(["main",this.pageNumber])}ngOnDestroy(){}static \u0275fac=function(e){return new(e||o)(r(K),r(B),r(N),r(O),r(R),r(T),r(D),r(j))};static \u0275cmp=I({type:o,selectors:[["app-main"]],viewQuery:function(e,i){if(e&1&&x(v,5),e&2){let s;C(s=M())&&(i.textarea=s.first)}},decls:10,vars:6,consts:[["textarea",""],[1,"container"],[3,"placeholderText","disablePostButton"],[1,"text-area-p"],[3,"list","showSeperator"],[2,"display","flex","justify-content","space-between"],[3,"click","disabled"],[3,"sendText","placeholderText","disablePostButton"],["aria-busy","true"]],template:function(e,i){e&1&&(a(0,"div",1),y(1,k,2,2,"app-textarea",2)(2,Q,2,0,"p",3)(3,L,2,0),h(4,"app-postlist",4),a(5,"div",5)(6,"button",6),c("click",function(){return i.loadNew()}),d(7,"Load New"),p(),a(8,"button",6),c("click",function(){return i.loadOld()}),d(9,"Load Older"),p()()()),e&2&&(n(),u(i._authService.userdata()?1:2),n(2),u(i.showProgress?3:-1),n(),l("list",i.allPosts)("showSeperator",!1),n(2),l("disabled",i.pageNumber==0),n(2),l("disabled",i.allPosts[i.allPosts.length-1]&&i.allPosts[i.allPosts.length-1].id==1))},dependencies:[E,v],styles:["button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:auto}"]})};export{V as MainComponent};
