import './polyfills.server.mjs';
import{a as b}from"./chunk-LFZ7PUEJ.mjs";import{a as M,b as N}from"./chunk-DPRFCPLE.mjs";import"./chunk-IMJPQH4Q.mjs";import{b as T}from"./chunk-BEMH4ZAT.mjs";import{$ as _,M as s,N as m,S as v,U as c,W as u,Xa as y,Z as r,_ as a,aa as x,ba as f,ca as l,da as C,ea as g,fa as S,ha as h,n as P,oa as w,s as p,t as d}from"./chunk-5XPW4WTW.mjs";import"./chunk-5XUXGTUW.mjs";function A(t,i){if(t&1){let e=x();r(0,"app-textarea",5,0),f("sendText",function(n){p(e);let O=l();return d(O.add(n))}),a()}if(t&2){let e=l();c("placeholderText","What is happening?")("disablePostButton",e.disablePostButton)}}function B(t,i){t&1&&(r(0,"p",3),h(1,"Login to post"),a())}function I(t,i){t&1&&_(0,"br")(1,"progress",6)}function j(t,i){t&1&&_(0,"div",4)}function k(t,i){if(t&1){let e=x();_(0,"app-postlist",7),r(1,"div",8)(2,"button",9),f("click",function(){p(e);let n=l();return d(n.loadNew())}),h(3,"Load New"),a(),r(4,"button",9),f("click",function(){p(e);let n=l();return d(n.loadOld())}),h(5,"Load Older"),a()()}if(t&2){let e=l();c("list",e.allPosts)("showSeperator",!1),s(2),c("disabled",e.pageNumber==0),s(2),c("disabled",e.allPosts[e.allPosts.length-1]&&e.allPosts[e.allPosts.length-1].id==1)}}var V=class t{constructor(i,e,o){this._postService=i;this._authService=e;this.viewportScroller=o}allPosts=[];pageNumber=0;disablePostButton=!1;loading=!1;showProgress=!1;textarea;ngOnInit(){this.getAllPosts()}getAllPosts(){this.loading=!0,this._postService.getAllPosts(this._authService.userdata()?.id??null,this.pageNumber).subscribe({next:i=>{this.allPosts=i,this.loading=!1}})}add(i){this.disablePostButton=!0,this.showProgress=!0,this._postService.addNewPost({content:i.content,parentpostid:null,file:i.file}).pipe().subscribe({next:e=>{this.pageNumber=0,this.getAllPosts(),this.disablePostButton=!1,this._postService.postSuccessSubject.next("success"),this.showProgress=!1,this.textarea.reset()},error:e=>{alert(e.error),this.disablePostButton=!1,this._postService.postSuccessSubject.next("fail"),this.showProgress=!1}})}loadNew(){this.pageNumber--,this.getAllPosts()}loadOld(){this.pageNumber++,this.getAllPosts()}ngOnDestroy(){}static \u0275fac=function(e){return new(e||t)(m(M),m(T),m(y))};static \u0275cmp=P({type:t,selectors:[["app-main"]],viewQuery:function(e,o){if(e&1&&C(b,5),e&2){let n;g(n=S())&&(o.textarea=n.first)}},standalone:!0,features:[w],decls:6,vars:3,consts:[["textarea",""],[1,"container"],[3,"placeholderText","disablePostButton"],[1,"text-area-p"],[1,"spinner","center-block"],[3,"sendText","placeholderText","disablePostButton"],["aria-busy","true"],[3,"list","showSeperator"],[2,"display","flex","justify-content","space-between"],[3,"click","disabled"]],template:function(e,o){e&1&&(r(0,"div",1),v(1,A,2,2,"app-textarea",2)(2,B,2,0,"p",3)(3,I,2,0)(4,j,1,0,"div",4)(5,k,6,4),a()),e&2&&(s(),u(o._authService.userdata()?1:2),s(2),u(o.showProgress?3:-1),s(),u(o.loading?4:5))},dependencies:[N,b],styles:["button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:auto}"]})};export{V as MainComponent};
