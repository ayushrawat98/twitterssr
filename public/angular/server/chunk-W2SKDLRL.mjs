import './polyfills.server.mjs';
import{a as C}from"./chunk-QOM36H4D.mjs";import"./chunk-V3NXXGHP.mjs";import{a as D,b as V}from"./chunk-OD4Q6EQH.mjs";import{$ as l,$a as P,C as S,J as r,L as s,M as T,Q as u,W as p,Y as d,_a as _,aa as c,ba as a,ca as I,da as j,e as y,ea as m,fa as f,ga as h,ha as v,ja as x,mb as R,nb as A,q as b,qb as B,r as w,ra as M,tb as E,yb as O}from"./chunk-FFTIX3AM.mjs";import"./chunk-S6KH3LOX.mjs";var U=["emptydiv"],$=i=>[i];function k(i,e){i&1&&a(0,"div",1)}function F(i,e){if(i&1&&a(0,"app-postlist",3),i&2){let t=m(2);p("list",t.post.ParentPosts)("showSeperator",!0)}}function N(i,e){if(i&1){let t=I();l(0,"app-textarea",7),j("sendText",function(n){b(t);let g=m(2);return w(g.add(n))}),c()}if(i&2){let t=m(2);p("disablePostButton",t.disablePostButton)}}function q(i,e){i&1&&(l(0,"p",5),x(1,"Login to post"),c())}function z(i,e){i&1&&a(0,"br")(1,"progress",8)}function L(i,e){if(i&1&&(l(0,"div",2),u(1,F,1,2,"app-postlist",3),a(2,"app-postlist",3),l(3,"div",null,0),x(5,"\xA0"),c(),u(6,N,1,1,"app-textarea",4)(7,q,2,0,"p",5)(8,z,2,0),a(9,"app-postlist",6),c()),i&2){let t=m();r(),d(t.post.ParentPosts?1:-1),r(),p("list",M(6,$,t.post))("showSeperator",!1),r(4),d(t._authservice.userdata()?6:7),r(2),d(t.showProgress?8:-1),r(),p("list",t.post.ChildPosts)}}var Q=class i{constructor(e,t,o,n,g,G,H){this.route=e;this._postservice=t;this._authservice=o;this.router=n;this.platformId=g;this.titleService=G;this.metaService=H}post;clearTextArea=0;emptydiv;data;disablePostButton=!1;loading=!1;showProgress=!1;textarea;ngOnInit(){P(this.platformId)&&(this.data={username:this.route.snapshot.paramMap.get("username")??"",id:this.route.snapshot.paramMap.get("id")??""},this.getPost()),_(this.platformId)&&(this.loading=!0,this.route.params.subscribe({next:e=>{this.data={username:e.username,id:e.id},this.getPost()}}))}getPost(){this._postservice.getPostById(this.data.username,this.data.id,this._authservice.userdata()?.id??null).pipe().subscribe({next:e=>{this.post=e,this.setMetaData(),_(this.platformId)&&setTimeout(()=>this.emptydiv.nativeElement.scrollIntoView({behavior:"smooth"}),600),this.loading=!1},error:e=>{alert(e.error),this.loading=!1}})}add(e){(this._authservice.userdata()?.id??0)!=0&&(this.disablePostButton=!0,this.showProgress=!0,this._postservice.addNewPost({content:e.content,parentpostid:this.post.id,file:e.file}).pipe(y(1e3)).subscribe({next:o=>{this.getPost(),this.disablePostButton=!1,this._postservice.postSuccessSubject.next("success"),this.showProgress=!1,this.textarea.reset()},error:o=>{alert(o.error),this.disablePostButton=!1,this._postservice.postSuccessSubject.next("fail"),this.showProgress=!1}}))}setMetaData(){if(P(this.platformId)){let e=`${this.post.User.username} said : ${this.post.content}`,t=`${this.post.content}`,o=`${this.post.User.username}`;this.titleService.setTitle(e),this.metaService.addTags([{name:"description",content:t},{name:"author",content:o},{property:"og:title",content:e},{property:"og:description",content:t},{property:"og:type",content:"website"},{name:"twitter:title",content:e},{name:"twitter:description",content:t}])}}static \u0275fac=function(t){return new(t||i)(s(B),s(D),s(O),s(E),s(S),s(A),s(R))};static \u0275cmp=T({type:i,selectors:[["app-postexpanded"]],viewQuery:function(t,o){if(t&1&&(f(U,5),f(C,5)),t&2){let n;h(n=v())&&(o.emptydiv=n.first),h(n=v())&&(o.textarea=n.first)}},decls:2,vars:1,consts:[["emptydiv",""],[1,"spinner","center-block"],[1,"container"],[3,"list","showSeperator"],["placeholderText","Post your reply",3,"disablePostButton"],[1,"text-area-p"],[3,"list"],["placeholderText","Post your reply",3,"sendText","disablePostButton"],["aria-busy","true"]],template:function(t,o){t&1&&u(0,k,1,0,"div",1)(1,L,10,8,"div",2),t&2&&d(o.loading?0:o.post?1:-1)},dependencies:[V,C],styles:["textarea[_ngcontent-%COMP%]{margin:8px 0;width:100%;font-size:16px;padding:8px;border-radius:8px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;resize:none}"]})};export{Q as PostexpandedComponent};
