import './polyfills.server.mjs';
import{a as x}from"./chunk-QOM36H4D.mjs";import"./chunk-V3NXXGHP.mjs";import{a as B,b as E}from"./chunk-OD4Q6EQH.mjs";import{$ as a,$a as b,C,E as w,J as s,L as r,M as T,Q as I,W as p,Y as u,_a as _,aa as l,ba as h,bb as N,ca as v,da as f,ea as c,fa as y,ga as A,ha as M,ja as g,l as P,mb as j,nb as D,q as d,qb as O,r as m,tb as V,yb as R}from"./chunk-FFTIX3AM.mjs";import"./chunk-S6KH3LOX.mjs";function k(i,e){if(i&1){let t=v();a(0,"app-textarea",5,0),f("sendText",function(n){d(t);let S=c();return m(S.add(n))}),l()}if(i&2){let t=c();p("placeholderText","What is happening?")("disablePostButton",t.disablePostButton)}}function Q(i,e){i&1&&(a(0,"p",3),g(1,"Login to post"),l())}function L(i,e){i&1&&h(0,"br")(1,"progress",6)}function q(i,e){i&1&&h(0,"div",4)}function F(i,e){if(i&1){let t=v();h(0,"app-postlist",7),a(1,"div",8)(2,"button",9),f("click",function(){d(t);let n=c();return m(n.loadNew())}),g(3,"Load New"),l(),a(4,"button",9),f("click",function(){d(t);let n=c();return m(n.loadOld())}),g(5,"Load Older"),l()()}if(i&2){let t=c();p("list",t.allPosts)("showSeperator",!1),s(2),p("disabled",t.pageNumber==0),s(2),p("disabled",t.allPosts[t.allPosts.length-1]&&t.allPosts[t.allPosts.length-1].id==1)}}var K=class i{constructor(e,t,o,n,S,U,W,z){this._postService=e;this._authService=t;this.viewportScroller=o;this.route=n;this.router=S;this.platformId=U;this.titleService=W;this.metaService=z}allPosts=[];pageNumber=0;disablePostButton=!1;loading=!1;showProgress=!1;textarea;request;MAIN_DATA="MAIN_DATA";transferState=P(w);ngOnInit(){this.titleService.setTitle("Khichdi"),b(this.platformId)&&(this.pageNumber=Number(this.route.snapshot.paramMap.get("page")),this.getAllPosts(this.pageNumber),this.metaService.addTags([{name:"description",content:"Khichdi is a fast, simple, and Indian-focused microblogging platform to share thoughts, updates, and trends."},{name:"author",content:"Khichdi Team"},{property:"og:title",content:"Khichdi Team"},{property:"og:description",content:"Khichdi is a fast, simple, and Indian-focused microblogging platform to share thoughts, updates, and trends."},{property:"og:type",content:"website"},{name:"twitter:title",content:"Khichdi"},{name:"twitter:description",content:"Khichdi is a fast, simple, and Indian-focused microblogging platform to share thoughts, updates, and trends."}])),_(this.platformId)&&this.route.paramMap.subscribe(e=>{this.pageNumber=Number(e.get("page")),this.getAllPosts(Number(e.get("page")))})}getAllPosts(e){if(_(this.platformId)){this.loading=!0;let t=this.transferState.get(this.MAIN_DATA,null);if(t){this.allPosts=t,this.transferState.remove(this.MAIN_DATA),this.loading=!1;return}}this._postService.getAllPosts(this._authService.userdata()?.id??null,e??0).subscribe({next:t=>{b(this.platformId)&&this.transferState.set(this.MAIN_DATA,t),this.allPosts=t,_(this.platformId)&&(this.viewportScroller.scrollToPosition([0,0]),this.loading=!1)}})}add(e){this.disablePostButton=!0,this.showProgress=!0,this._postService.addNewPost({content:e.content,parentpostid:null,file:e.file}).pipe().subscribe({next:t=>{this.pageNumber=0,this.getAllPosts(0),this.disablePostButton=!1,this._postService.postSuccessSubject.next("success"),this.showProgress=!1,this.textarea.reset()},error:t=>{alert(t.error),this.disablePostButton=!1,this._postService.postSuccessSubject.next("fail"),this.showProgress=!1}})}loadNew(){this.pageNumber--,this.router.navigate(["main",this.pageNumber])}loadOld(){this.pageNumber++,this.router.navigate(["main",this.pageNumber])}ngOnDestroy(){}static \u0275fac=function(t){return new(t||i)(r(B),r(R),r(N),r(O),r(V),r(C),r(D),r(j))};static \u0275cmp=T({type:i,selectors:[["app-main"]],viewQuery:function(t,o){if(t&1&&y(x,5),t&2){let n;A(n=M())&&(o.textarea=n.first)}},decls:6,vars:3,consts:[["textarea",""],[1,"container"],[3,"placeholderText","disablePostButton"],[1,"text-area-p"],[1,"spinner","center-block"],[3,"sendText","placeholderText","disablePostButton"],["aria-busy","true"],[3,"list","showSeperator"],[2,"display","flex","justify-content","space-between"],[3,"click","disabled"]],template:function(t,o){t&1&&(a(0,"div",1),I(1,k,2,2,"app-textarea",2)(2,Q,2,0,"p",3)(3,L,2,0)(4,q,1,0,"div",4)(5,F,6,4),l()),t&2&&(s(),u(o._authService.userdata()?1:2),s(2),u(o.showProgress?3:-1),s(),u(o.loading?4:5))},dependencies:[E,x],styles:["button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:auto}"]})};export{K as MainComponent};
